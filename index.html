const outputElement = document.getElementById('output');
let ws;

function createWebSocketConnection() {
    ws = new WebSocket('ws://localhost:8000/ws/process-image/');

    ws.onmessage = function(event) {
        outputElement.innerText = event.data;
    };

    ws.onerror = function(error) {
        outputElement.innerText = "WebSocket Error: " + error;
    };

    ws.onclose = function(event) {
        if (event.wasClean) {
            outputElement.innerText = `Connection closed cleanly, code=${event.code}, reason=${event.reason}`;
        } else {
            outputElement.innerText = 'Connection died';
        }
    };
}

function uploadImage() {
    const fileInput = document.getElementById('imageUploader');
    const file = fileInput.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
            if (ws.readyState === WebSocket.OPEN) {
                ws.send(event.target.result);
            } else {
                outputElement.innerText = "WebSocket is not open. Please try again.";
            }
        };
        reader.readAsArrayBuffer(file);
    }
}

// Initiate the WebSocket connection when the page loads
createWebSocketConnection();

